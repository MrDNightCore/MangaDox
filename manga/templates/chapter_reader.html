{% extends "base.html" %}
{% load static %}
{% block title %}{{ manga.title }} — Ch. {{ chapter.number }} — MangaDox{% endblock %}
{% block extra_head %}<style>body{background:var(--bg)!important;}.site-header,.site-footer{display:none;}</style>{% endblock %}
{% block content %}
<!-- Reader Navigation Bar -->
<div class="reader-nav">
  <a href="{% url 'manga_detail' manga.slug %}" class="reader-back"><i class="fas fa-arrow-left"></i> {{ manga.title|truncatechars:30 }}</a>
  <div class="reader-controls">
    {% if prev_chapter %}
    <a href="{% url 'chapter_reader' manga.slug prev_chapter.number %}" class="btn btn-sm btn-outline" id="prev-btn"><i class="fas fa-chevron-left"></i> Prev</a>
    {% else %}
    <span class="btn btn-sm btn-outline disabled"><i class="fas fa-chevron-left"></i> Prev</span>
    {% endif %}

    <select class="form-select reader-select" id="chapter-select" onchange="window.location.href=this.value">
      {% for ch in all_chapters %}
      <option value="{% url 'chapter_reader' manga.slug ch.number %}" {% if ch.number == chapter.number %}selected{% endif %}>
        Ch. {{ ch.number }}{% if ch.title %} — {{ ch.title }}{% endif %}
      </option>
      {% endfor %}
    </select>

    {% if next_chapter %}
    <a href="{% url 'chapter_reader' manga.slug next_chapter.number %}" class="btn btn-sm btn-outline" id="next-btn">Next <i class="fas fa-chevron-right"></i></a>
    {% else %}
    <span class="btn btn-sm btn-outline disabled">Next <i class="fas fa-chevron-right"></i></span>
    {% endif %}
  </div>
</div>

<!-- Chapter Images -->
<div class="reader-container" id="reader-container">
  <h2 class="reader-title">{{ manga.title }} — Chapter {{ chapter.number }}{% if chapter.title %}: {{ chapter.title }}{% endif %}</h2>

  {% if images %}
    {% for img in images %}
    <div class="reader-page">
      <img src="{{ img.image.url }}" alt="Page {{ img.order|add:1 }}" loading="lazy">
    </div>
    {% endfor %}
  {% else %}
    <div class="empty-state" style="padding:80px 20px;">
      <i class="fas fa-images" style="font-size:48px;opacity:.3;margin-bottom:16px;display:block;"></i>
      <h3>No pages uploaded yet</h3>
      <p>This chapter has no images. Please check back later.</p>
    </div>
  {% endif %}
</div>

<!-- Bottom Navigation -->
<div class="reader-bottom-nav">
  {% if prev_chapter %}
  <a href="{% url 'chapter_reader' manga.slug prev_chapter.number %}" class="btn btn-outline"><i class="fas fa-chevron-left"></i> Previous Chapter</a>
  {% else %}
  <span></span>
  {% endif %}

  <a href="{% url 'manga_detail' manga.slug %}" class="btn btn-outline"><i class="fas fa-list"></i> All Chapters</a>

  {% if next_chapter %}
  <a href="{% url 'chapter_reader' manga.slug next_chapter.number %}" class="btn btn-primary">Next Chapter <i class="fas fa-chevron-right"></i></a>
  {% else %}
  <span class="btn btn-outline disabled">Last Chapter</span>
  {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('keydown',function(e){
  if(e.key==='ArrowLeft'){var p=document.getElementById('prev-btn');if(p&&!p.classList.contains('disabled'))p.click();}
  if(e.key==='ArrowRight'){var n=document.getElementById('next-btn');if(n&&!n.classList.contains('disabled'))n.click();}
});
</script>
{% endblock %}
