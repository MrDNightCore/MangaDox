{% extends "admin/base_admin.html" %}
{% block title %}Manage Users{% endblock %}
{% block admin_content %}
<h1 class="admin-page-title">Users</h1>

<form method="GET" class="admin-search">
  <input type="text" name="q" value="{{ query }}" placeholder="Search by username or email..." class="form-input">
  <button type="submit" class="btn btn-primary btn-sm"><i class="fas fa-search"></i></button>
</form>

<table class="admin-table">
  <thead><tr><th>Username</th><th>Email</th><th>Admin</th><th>Active</th><th>Locked</th><th>Joined</th><th>Actions</th></tr></thead>
  <tbody>
    {% for u in users %}
    <tr>
      <td><strong>{{ u.username }}</strong></td>
      <td>{{ u.email }}</td>
      <td>{% if u.is_admin %}<span class="badge badge-accent">Admin</span>{% else %}—{% endif %}</td>
      <td>{% if u.is_active %}<i class="fas fa-check-circle" style="color:var(--success)"></i>{% else %}<i class="fas fa-times-circle" style="color:var(--danger)"></i>{% endif %}</td>
      <td>{% if u.is_locked %}<i class="fas fa-lock" style="color:var(--warning)"></i>{% else %}—{% endif %}</td>
      <td>{{ u.created_at|timesince }} ago</td>
      <td class="action-cell">
        <a href="{% url 'admin_reset_password' u.id %}" class="btn btn-sm btn-outline" title="Reset Password"><i class="fas fa-key"></i></a>
        <form method="POST" action="{% url 'admin_toggle_user_status' u.id %}" style="display:inline">
          {% csrf_token %}
          <button type="submit" class="btn btn-sm {% if u.is_active %}btn-warning{% else %}btn-primary{% endif %}" title="{% if u.is_active %}Deactivate{% else %}Activate{% endif %}">
            <i class="fas {% if u.is_active %}fa-user-slash{% else %}fa-user-check{% endif %}"></i>
          </button>
        </form>
        <form method="POST" action="{% url 'admin_toggle_admin_status' u.id %}" style="display:inline" onsubmit="return confirm('Toggle admin status for {{ u.username }}?')">
          {% csrf_token %}
          <button type="submit" class="btn btn-sm btn-outline" title="Toggle Admin">
            <i class="fas fa-shield-alt"></i>
          </button>
        </form>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="7" class="text-muted" style="text-align:center">No users found.</td></tr>
    {% endfor %}
  </tbody>
</table>

{% if users.has_other_pages %}
<nav class="pagination">
  {% if users.has_previous %}<a href="?page={{ users.previous_page_number }}&q={{ query }}" class="page-link"><i class="fas fa-chevron-left"></i></a>{% endif %}
  {% for num in users.paginator.page_range %}
    {% if users.number == num %}<span class="page-link active">{{ num }}</span>
    {% elif num > users.number|add:"-3" and num < users.number|add:"3" %}<a href="?page={{ num }}&q={{ query }}" class="page-link">{{ num }}</a>{% endif %}
  {% endfor %}
  {% if users.has_next %}<a href="?page={{ users.next_page_number }}&q={{ query }}" class="page-link"><i class="fas fa-chevron-right"></i></a>{% endif %}
</nav>
{% endif %}
{% endblock %}
