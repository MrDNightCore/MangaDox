{% extends "base.html" %}
{% load static %}
{% block title %}Latest Updates — MangaDox{% endblock %}
{% block content %}
<section class="section">
  <div class="wrap">
    <h1 class="page-title"><i class="fas fa-clock"></i> Latest Updates</h1>
    <p class="page-subtitle">New chapters as soon as they are translated.</p>

    <!-- Type filter tabs -->
    <div class="type-tabs">
      <a href="{% url 'updates' %}" class="tab-pill {% if not current_type %}active{% endif %}">All</a>
      <a href="{% url 'updates' %}?type=Manga" class="tab-pill {% if current_type == 'Manga' %}active{% endif %}">Manga</a>
      <a href="{% url 'updates' %}?type=Manhwa" class="tab-pill {% if current_type == 'Manhwa' %}active{% endif %}">Manhwa</a>
      <a href="{% url 'updates' %}?type=Manhua" class="tab-pill {% if current_type == 'Manhua' %}active{% endif %}">Manhua</a>
    </div>

    <div class="updates-layout">
      <!-- Updates list -->
      <div class="updates-main">
        {% if chapters %}
        <div class="updates-list">
          {% for ch in chapters %}
          <a href="{% url 'chapter_reader' ch.manga.slug ch.number %}" class="update-row">
            <img src="{{ ch.manga.get_cover_display }}" alt="{{ ch.manga.title }}" class="update-thumb" loading="lazy">
            <div class="update-info">
              <h4>{{ ch.manga.title }}</h4>
              <span class="update-chapter">Chapter {{ ch.number }}{% if ch.title %} — {{ ch.title }}{% endif %}</span>
              <span class="badge badge-sm">{{ ch.manga.manga_type }}</span>
            </div>
            <span class="update-time"><i class="far fa-clock"></i> {{ ch.created_at|timesince }} ago</span>
          </a>
          {% endfor %}
        </div>

        {% if chapters.has_other_pages %}
        <nav class="pagination">
          {% if chapters.has_previous %}
          <a href="?page={{ chapters.previous_page_number }}&type={{ current_type }}" class="page-link"><i class="fas fa-chevron-left"></i> Prev</a>
          {% endif %}
          {% for num in chapters.paginator.page_range %}
            {% if chapters.number == num %}
            <span class="page-link active">{{ num }}</span>
            {% elif num > chapters.number|add:"-3" and num < chapters.number|add:"3" %}
            <a href="?page={{ num }}&type={{ current_type }}" class="page-link">{{ num }}</a>
            {% endif %}
          {% endfor %}
          {% if chapters.has_next %}
          <a href="?page={{ chapters.next_page_number }}&type={{ current_type }}" class="page-link">Next <i class="fas fa-chevron-right"></i></a>
          {% endif %}
        </nav>
        {% endif %}
        {% else %}
        <div class="empty-state">
          <i class="fas fa-inbox"></i>
          <h3>No updates yet</h3>
        </div>
        {% endif %}
      </div>

      <!-- Sidebar: Popular -->
      {% if popular_manga %}
      <aside class="updates-sidebar">
        <h3><i class="fas fa-fire"></i> Most Viewed</h3>
        <div class="sidebar-list">
          {% for m in popular_manga %}
          <a href="{% url 'manga_detail' m.slug %}" class="sidebar-item">
            <img src="{{ m.get_cover_display }}" alt="{{ m.title }}" loading="lazy">
            <div>
              <h4>{{ m.title|truncatechars:40 }}</h4>
              <span class="text-muted"><i class="fas fa-eye"></i> {{ m.views }}</span>
            </div>
          </a>
          {% endfor %}
        </div>
      </aside>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
